<!DOCTYPE html>
<html>
<head>
   <meta charset="UTF-8">
   <title>CIESPAL 2024</title>
   <style>
       body { 
           margin: 0; 
           background: white; 
           font-family: Arial, sans-serif;
       }
       .node text { 
           font-size: 13px;
           fill: #333;
           font-weight: 500;
       }
       .node circle { 
           fill: white;
           stroke-width: 2px;
           transition: r 0.3s;
       }
       .link {
           fill: none;
           stroke: #999;
           stroke-width: 1.5px;
       }
       .node:hover circle {
           r: 8;
       }
       #tree-container {
           width: 100vw;
           height: 100vh;
       }
   </style>
   <script src="https://d3js.org/d3.v7.min.js"></script>
</head>
<body>
   <div id="tree-container"></div>
   <script>
       const data = {
           name: "CIESPAL 2024",
           children: [
               {
                   name: "Gestión Financiera",
                   color: "#FFD700",
                   children: [
                       {
                           name: "Ingresos",
                           children: [
                               {name: "SENESCYT: $330,632"},
                               {name: "Autogestión: $169,852"},
                               {name: "Eventos: $38,908"}
                           ]
                       },
                       {
                           name: "Proyectos",
                           children: [
                               {name: "6 Ejecutados: $281,800"},
                               {name: "6 Negociación: $612,880"}
                           ]
                       }
                   ]
               },
               {
                   name: "Proyectos Estratégicos",
                   color: "#90EE90",
                   children: [
                       {
                           name: "Onda Rural",
                           children: [
                               {name: "52 programas radio"},
                               {name: "800 radios aliadas"},
                               {name: "20 módulos info"},
                               {name: "8h Foro Global"}
                           ]
                       },
                       {
                           name: "RETO 24",
                           children: [
                               {name: "19 celumetrajes"},
                               {name: "120 participantes"},
                               {name: "4 categorías"}
                           ]
                       },
                       {
                           name: "BEA",
                           children: [
                               {name: "150 estudiantes"},
                               {name: "5 países"},
                               {name: "Paneles IA"}
                           ]
                       },
                       {
                           name: "Creadoras",
                           children: [
                               {name: "90 emprendedoras"},
                               {name: "45 productos"},
                               {name: "2 ferias"}
                           ]
                       },
                       {
                           name: "Educomunicadores",
                           children: [
                               {name: "228 participantes"},
                               {name: "96 talleres"},
                               {name: "12 barrios"}
                           ]
                       }
                   ]
               },
               {
                   name: "Producción Académica",
                   color: "#87CEEB",
                   children: [
                       {
                           name: "Cátedras",
                           children: [
                               {
                                   name: "UNESCO",
                                   children: [
                                       {name: "Renovación 4 años"},
                                       {name: "Serie Interculturalidad"},
                                       {name: "3 jornadas"}
                                   ]
                               },
                               {
                                   name: "Kaplún",
                                   children: [
                                       {name: "6 sesiones"},
                                       {name: "Curso Fact-checking"},
                                       {name: "Libro Hoy es mañana"}
                                   ]
                               },
                               {
                                   name: "Mattelart",
                                   children: [
                                       {name: "5 conversatorios"},
                                       {name: "Serie Comunicación"},
                                       {name: "Transmetodología"}
                                   ]
                               }
                           ]
                       },
                       {
                           name: "Publicaciones",
                           children: [
                               {name: "13 libros"},
                               {name: "3 revistas Chasqui"}
                           ]
                       }
                   ]
               },
               {
                   name: "Comunicación",
                   color: "#DDA0DD",
                   children: [
                       {
                           name: "Digital",
                           children: [
                               {name: "225 publicaciones"},
                               {name: "127 producciones"},
                               {name: "98k visitas"}
                           ]
                       },
                       {
                           name: "Redes",
                           children: [
                               {name: "FB: 679k alcance"},
                               {name: "TW: 267k"},
                               {name: "IG: 35k"}
                           ]
                       }
                   ]
               }
           ]
       };

       const width = 1800;
       const height = 1000;
       const margin = {top: 50, right: 120, bottom: 50, left: 120};

       const svg = d3.select("#tree-container")
           .append("svg")
           .attr("width", width)
           .attr("height", height)
           .append("g")
           .attr("transform", `translate(${margin.left},${margin.top})`);

       const tree = d3.tree()
           .size([height - margin.top - margin.bottom, width - margin.right - margin.left]);

       const root = d3.hierarchy(data);
       tree(root);

       // Añadir enlaces con animación
       const link = svg.selectAll(".link")
           .data(root.links())
           .enter()
           .append("path")
           .attr("class", "link")
           .attr("d", d3.linkHorizontal()
               .x(d => d.y)
               .y(d => d.x))
           .style("opacity", 0)
           .transition()
           .duration(1000)
           .delay((d, i) => i * 100)
           .style("opacity", 1);

       // Añadir nodos con animación
       const node = svg.selectAll(".node")
           .data(root.descendants())
           .enter()
           .append("g")
           .attr("class", "node")
           .attr("transform", d => `translate(${d.y},${d.x})`)
           .style("opacity", 0)
           .transition()
           .duration(1000)
           .delay((d, i) => i * 100)
           .style("opacity", 1);

       // Círculos
       node.append("circle")
           .attr("r", 6)
           .style("stroke", d => d.data.color || 
               (d.depth === 0 ? "#4299e1" : 
                d.depth === 1 ? "#48bb78" : 
                d.depth === 2 ? "#ed8936" : "#9f7aea"));

       // Texto
       node.append("text")
           .attr("dy", "0.31em")
           .attr("x", d => d.children ? -10 : 10)
           .attr("text-anchor", d => d.children ? "end" : "start")
           .text(d => d.data.name)
           .style("fill-opacity", 0)
           .transition()
           .duration(2000)
           .style("fill-opacity", 1);

       // Zoom interactivo
       const zoom = d3.zoom()
           .scaleExtent([0.5, 2])
           .on("zoom", (event) => {
               svg.attr("transform", event.transform);
           });

       d3.select("svg").call(zoom);
   </script>
</body>
</html>
